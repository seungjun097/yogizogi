<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="~{/layout/basic::setContent(~{this::content})}">
    <th:block th:fragment="content">
        <script type="text/javascript"
                src="//dapi.kakao.com/v2/maps/sdk.js?appkey=7e400eae390747a237232735511d63bb&libraries=services,clusterer,drawing"></script>

        <h1>가게정보</h1>
        <div class="form-group">
            <label>가게이름</label>
            <input type="text" class="form-control" id="storeName" name="storeName" th:value="${storeDTO.storeName}"/>
        </div>
        <div class="form-group">
            <label>가게 핸드폰 번호</label>
            <input type="text" class="form-control" id="storePhone" name="storePhone" th:value="${storeDTO.storePhone}"/>
        </div>
        <div id="store_address" th:data-address="${storeDTO.getStoreAddress2()}"></div>
        <div id="store_Name" th:data-store_name="${storeDTO.storeName}"></div>
        <div id="map" style="width:500px;height:400px;">
           <script>
               $(document).ready(function(){
                   var storeAddress = $("#store_address").data("address");
                   console.log("storeAdd: "+ storeAddress)
                   var storeName = $("#store_Name").data("store_name");
                   console.log("storeName: " + storeName)
                   var mapContainer = document.getElementById('map'), // 지도를 표시할 div
                       mapOption = {
                           center: new kakao.maps.LatLng(33.25110701, 126.570667), // 지도의 중심좌표
                           level: 3 // 지도의 확대 레벨
                       };
                   // 지도를 생성합니다
                   var map = new kakao.maps.Map(mapContainer, mapOption);
                   // 주소-좌표 변환 객체를 생성합니다
                   var geocoder = new kakao.maps.services.Geocoder();
                   // 주소로 좌표를 검색합니다
                   geocoder.addressSearch(storeAddress, function(result, status) {
                       // 정상적으로 검색이 완료됐으면
                       if (status === kakao.maps.services.Status.OK) {
                           var coords = new kakao.maps.LatLng(result[0].y, result[0].x);
                           // 결과값으로 받은 위치를 마커로 표시합니다
                           var marker = new kakao.maps.Marker({
                               map: map,
                               position: coords
                           });
                           // 인포윈도우로 장소에 대한 설명을 표시합니다
                           var infowindow = new kakao.maps.InfoWindow({
                               content: '<div style="width:150px;text-align:center;padding:3px 0;">' + storeName + '</div>'
                           });
                           infowindow.open(map, marker);
                           // 지도의 중심을 결과값으로 받은 위치로 이동시킵니다
                           map.setCenter(coords);
                           $(".storePosition").click(function(){
                               map.panTo(coords);
                           })
                       }
                   });
                   var userAddress = $("#delivery_address").val();
                   if(userAddress != "" ) {
                       $(".userPosition").css("display" , "inline");
                       // 주소로 좌표를 검색합니다
                       geocoder.addressSearch(userAddress, function(result, status) {
                           // 정상적으로 검색이 완료됐으면
                           if (status === kakao.maps.services.Status.OK) {
                               coords = new kakao.maps.LatLng(result[0].y, result[0].x);
                               // 결과값으로 받은 위치를 마커로 표시합니다
                               var marker = new kakao.maps.Marker({
                                   map: map,
                                   position: coords
                               });
                               // 인포윈도우로 장소에 대한 설명을 표시합니다
                               var infowindow = new kakao.maps.InfoWindow({
                                   content: '<div style="width:150px;text-align:center;padding:3px 0;">' + "배달받을위치" + '</div>'
                               });
                               infowindow.open(map, marker);

                               $(".userPosition").click(function(){
                                   map.panTo(coords);
                               })
                           }
                       });
                   }
               })
           </script>
        </div>
    </th:block>
</th:block>
</html>